# Twitch Giveaway Bot

Twitch бот для проведения розыгрышей с сохранением данных в Supabase.

## Описание

Этот бот позволяет стримерам проводить розыгрыши на Twitch, автоматически отслеживая участников по ключевому слову в чате и выбирая случайного победителя. Все данные сохраняются в базе данных Supabase для последующего анализа.

## Основные функции

- Автоматическое отслеживание участников по ключевому слову в чате Twitch
- Выбор случайного победителя из списка участников
- Сохранение всех данных в базе данных Supabase
- Веб-интерфейс для управления розыгрышами
- История победителей с возможностью указания Telegram
- Уведомления в чат Twitch о начале и завершении розыгрышей
- Автоматическая загрузка изменений в репозиторий GitHub

## Технологии

- Node.js
- Express.js
- Socket.IO
- tmi.js (Twitch Chat Bot)
- Supabase (база данных)
- HTML/CSS/JavaScript (фронтенд)

## Установка

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/m-kotya/nasuvan.git
   ```

2. Перейдите в директорию проекта:
   ```
   cd nasuvan
   ```

3. Установите зависимости:
   ```
   npm install
   ```

## Настройка

### Переменные окружения

Создайте файл `.env` в корне проекта со следующими переменными:

```
# Twitch Bot Configuration
TWITCH_BOT_USERNAME=your_bot_username
TWITCH_OAUTH_TOKEN=oauth:your_token_here
TWITCH_CLIENT_ID=your_client_id
TWITCH_CLIENT_SECRET=your_client_secret

# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_supabase_key

# Application Configuration
APP_URL=http://localhost:3000
PORT=3000
```

### Настройка базы данных Supabase

Подробная инструкция по настройке базы данных находится в файле [SUPABASE_SETUP.md](SUPABASE_SETUP.md).

## Запуск

### В режиме разработки

```
npm run dev
```

### В production режиме

```
npm start
```

### Локальный запуск с переменными окружения

```
npm run local
```

## Использование

1. Запустите приложение
2. Перейдите по адресу `http://localhost:3000` (или указанному в переменной PORT)
3. Авторизуйтесь через Twitch
4. Введите ключевое слово для розыгрыша
5. Нажмите "Запуск"
6. Участники могут писать ключевое слово в чат Twitch для участия
7. Нажмите "Выбрать победителя" для выбора случайного участника

## Автоматическая загрузка изменений

Для автоматической загрузки изменений в репозиторий GitHub используется скрипт `auto-push.bat`. 
Запустите его для автоматического добавления, коммита и отправки изменений в удаленный репозиторий.

## Веб-интерфейс

### Главная страница

На главной странице вы можете:
- Авторизоваться через Twitch
- Запустить розыгрыш с указанным ключевым словом
- Просмотреть список участников
- Выбрать победителя
- Просмотреть чат Twitch в реальном времени

### История победителей

На странице истории победителей отображается:
- Имя победителя
- Время победы
- Общее количество побед
- Telegram победителя (если указан)
- Приз, который был выигран

### Обновление Telegram

На отдельной странице можно обновить Telegram для победителей.

## API

### Получение розыгрышей

```
GET /api/giveaways/:channel
```

### Начало розыгрыша

```
POST /api/start-giveaway
```

Тело запроса:
```json
{
  "keyword": "ключевое слово",
  "prize": "приз"
}
```

### Завершение розыгрыша

```
POST /api/end-giveaway
```

### Выбор победителя

```
POST /api/select-winner
```

### Получение истории победителей

```
GET /api/winners
```

### Обновление Telegram победителя

```
POST /api/update-telegram
```

Тело запроса:
```json
{
  "username": "имя пользователя",
  "telegram": "Telegram"
}
```

## Развертывание

### Railway

Приложение готово к развертыванию на Railway. Убедитесь, что все необходимые переменные окружения установлены в настройках проекта Railway.

### Docker

Приложение также может быть запущено в Docker контейнере. Используйте предоставленный Dockerfile.

## Структура проекта

```
twitch-giveaway-bot/
├── src/
│   ├── bot/              # Логика Twitch бота
│   ├── database/         # Работа с базой данных
│   └── web/              # Веб-сервер и API
├── public/               # Статические файлы (HTML, CSS, JS)
├── .env.example          # Пример файла переменных окружения
├── Dockerfile            # Docker конфигурация
├── package.json          # Зависимости и скрипты
└── railway.toml          # Конфигурация Railway
```

## Разработка

### Скрипты

- `npm run dev` - запуск в режиме разработки с автоматической перезагрузкой
- `npm start` - запуск в production режиме
- `npm run local` - запуск с загрузкой переменных окружения из .env файла

### Структура базы данных

Приложение использует Supabase в качестве базы данных с тремя основными таблицами:

1. `giveaways` - информация о розыгрышах
2. `participants` - участники розыгрышей
3. `winners` - победители розыгрышей с дополнительной информацией

## Лицензия

MIT

## Автор

Разработано для Twitch стримеров, которые хотят проводить честные розыгрыши и отслеживать историю победителей.